<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LUXIAFLOW – IA</title>
  <meta name="description" content="LUXIAFLOW – IA: Automação inteligente para WhatsApp com fluxos, respostas e treinamento personalizado." />
  <meta name="theme-color" content="#0a0f16" />
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <link id="favicon" rel="icon" href="logo.png" />
  <style>
    :root { --bg:#0a0f16; --panel:#0e1521; --panel2:#111a29; --neon:#21c8ff; --neon2:#00aaff; --text:#e8f1ff; --muted:#a2b3c8; --white:#ffffff; }
    * { box-sizing: border-box; }
    html, body { height:100%; scroll-behavior:smooth }
    body { margin:0; font-family:Poppins, Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: radial-gradient(1200px 800px at 10% -10%, rgba(33,200,255,0.08), transparent), radial-gradient(800px 500px at 90% -10%, rgba(0,170,255,0.08), transparent), var(--bg); color: var(--text); }
    a { color: inherit; text-decoration: none; }
    .header { position: sticky; top:0; z-index:50; background: rgba(10,15,22,0.85); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(33,200,255,0.18); }
    .inner { max-width: 1200px; margin: 0 auto; padding: 14px 20px; display:flex; align-items:center; gap:16px }
    .brand { display:flex; align-items:center; gap:12px }
    .logo { width: 120px; height: auto; filter: drop-shadow(0 10px 24px rgba(33,200,255,0.35)); }
    .nav { margin-left:auto; display:flex; gap: 14px; flex-wrap: wrap }
    .nav a { padding:10px 14px; border-radius:999px; color:#cfe7ff; opacity:0.92; transition: transform .25s ease, background .25s ease }
    .nav a:hover { transform: translateY(-2px); background: rgba(33,200,255,0.12) }
    .mobile-toggle { display:none; margin-left:auto; appearance:none; border:0; border-radius:12px; padding:10px 12px; font-weight:800; background: linear-gradient(180deg, var(--neon), var(--neon2)); color:#041423; box-shadow:0 10px 20px rgba(33,200,255,0.35); }
    .btn { appearance:none; border:0; border-radius:16px; padding:14px 22px; font-weight:800; letter-spacing:0.02em; cursor:pointer; transition: transform .25s ease, box-shadow .25s ease, filter .25s ease }
    .btn-primary { color:#041423; background: linear-gradient(180deg, var(--neon), var(--neon2)); box-shadow: 0 16px 30px rgba(33,200,255,0.45), inset 0 0 0 1px rgba(255,255,255,0.2) }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 24px 44px rgba(33,200,255,0.55); filter: brightness(1.08) }
    .btn-secondary { color:#d7e9ff; background: linear-gradient(180deg, #121a28, #0d1625); box-shadow: 0 12px 22px rgba(0,0,0,0.35); border:1px solid rgba(33,200,255,0.25) }
    .hero { position:relative; overflow:hidden }
    .hero-inner { max-width:1200px; margin:0 auto; padding:80px 20px; display:grid; gap:18px; grid-template-columns: 1.1fr .9fr; align-items:center }
    .hero h1 { margin:0; font-size: clamp(32px, 6vw, 54px); letter-spacing:-0.02em }
    .hero p { margin:0; font-size: clamp(16px, 2.8vw, 20px); color: var(--muted) }
    .mock { width: min(520px, 100%); justify-self: center; border-radius: 24px; background: linear-gradient(135deg, #0f1827, #101827); box-shadow: 0 30px 80px rgba(33,200,255,0.18); height: 300px; display:grid; place-items:center; color: var(--neon); font-weight:800; border: 1px solid rgba(33,200,255,0.25) }
    .section { max-width:1200px; margin:0 auto; padding:64px 20px }
    .section h2 { margin:0 0 14px; font-size: clamp(24px, 4.8vw, 34px) }
    .muted { color: var(--muted) }
    .grid-3 { display:grid; gap:16px; grid-template-columns: repeat(3, minmax(0, 1fr)) }
    .grid-2 { display:grid; gap:16px; grid-template-columns: repeat(2, minmax(0, 1fr)) }
    .grid-4 { display:grid; gap:16px; grid-template-columns: repeat(4, minmax(0, 1fr)) }
    .card { border-radius:18px; background: linear-gradient(180deg, var(--panel), var(--panel2)); box-shadow: 0 18px 60px rgba(0,0,0,0.45); padding:20px; border: 1px solid rgba(33,200,255,0.18) }
    .icon { width:46px; height:46px; border-radius:12px; display:grid; place-items:center; background: radial-gradient(circle at 50% 0%, rgba(33,200,255,0.25), rgba(33,200,255,0.08)); color: var(--neon); box-shadow: 0 10px 24px rgba(33,200,255,0.18) }
    input, select, textarea { width:100%; padding:12px 14px; border-radius:14px; border:1px solid rgba(33,200,255,0.25); background:#0e1521; color:#d7e9ff; font-size:14px }
    textarea { min-height: 120px }
    .table-wrap { overflow:auto }
    .table { width:100%; border-collapse: collapse }
    .table th, .table td { border-bottom: 1px solid rgba(33,200,255,0.18); padding:8px }
    .footer { border-top: 1px solid rgba(33,200,255,0.18); background: #0b111d; margin-top:40px }
    .footer-inner { max-width:1200px; margin:0 auto; padding:24px 20px; display:grid; gap:16px; grid-template-columns: 1.2fr .8fr; align-items:center }
    .footer-links { display:flex; gap:12px; flex-wrap: wrap; justify-content:flex-end }
    .reveal { opacity:0; transform:translateY(12px); transition: opacity .45s ease, transform .45s ease }
    .reveal.on { opacity:1; transform:translateY(0) }
    section, .hero { scroll-margin-top: 80px }
    @media (max-width: 900px) { .hero-inner { grid-template-columns:1fr; text-align:center } .mobile-toggle { display:inline-flex } .nav { position: fixed; top:0; right:0; width:74vw; max-width:340px; height:100dvh; background:#0b111d; box-shadow: -16px 0 40px rgba(0,0,0,0.35); display:flex; flex-direction:column; padding:18px; gap:10px; transform: translateX(100%); transition: transform .3s ease; z-index:60 } .nav.open { transform: translateX(0); display:flex } }
    @media (max-width: 700px) { .grid-3, .grid-2, .grid-4 { grid-template-columns:1fr } .btn { padding:12px 18px } input, select, textarea { font-size:16px } .mock { width: 100%; height: 240px } }
    @media (prefers-reduced-motion: reduce) { * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important } }
  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <div class="brand">
        <img class="logo" src="logo.png" alt="LUXIAFLOW – IA" />
      </div>
      <button id="menuBtn" class="mobile-toggle" aria-label="Abrir menu">Menu</button>
      <nav class="nav" id="navMain">
        <a href="#inicio">Início</a>
        <a href="#oque">O que é</a>
        <a href="#funcionalidades">Funcionalidades</a>
        <a href="#como">Como Funciona</a>
        <a href="#planos">Planos</a>
        <a href="#depoimentos">Depoimentos</a>
        <a href="#conta">Entrar</a>
        <a href="#conta" class="btn btn-primary">Criar Minha IA Agora</a>
      </nav>
    </div>
  </header>

  <section id="inicio" class="hero">
    <div class="hero-inner">
      <div class="reveal">
        <h1>LUXIAFLOW – IA — Automação Inteligente para WhatsApp</h1>
        <p>Configure seu bot, automatize conversas e responda clientes 24h por dia com inteligência.</p>
        <div style="margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; align-items:center">
          <a href="#conta" class="btn btn-primary">Criar Minha IA Agora</a>
          <a href="#planos" class="btn btn-secondary">Ver Planos</a>
        </div>
      </div>
      <div class="mock reveal">Mockup</div>
    </div>
  </section>

  <section id="oque" class="section reveal">
    <h2>O que é a LUXIAFLOW – IA</h2>
    <div class="card"><p class="muted">Permite configurar completamente sua IA para WhatsApp: respostas automáticas, gatilhos, fluxos personalizados, mensagens de venda, perguntas frequentes e treinamento da IA com dados do seu negócio. Conecte sua conta e acompanhe tudo no dashboard.</p></div>
  </section>

  <section id="funcionalidades" class="section reveal">
    <h2>Funcionalidades</h2>
    <div class="grid-3">
      <div class="card"><div class="icon">IQ</div><h3>Respostas inteligentes</h3><div class="muted">Atendimento natural e veloz, com contexto.</div></div>
      <div class="card"><div class="icon">TR</div><h3>Treino personalizado</h3><div class="muted">Use seus dados e documentos para treinar.</div></div>
      <div class="card"><div class="icon">FL</div><h3>Fluxos automáticos</h3><div class="muted">Crie jornadas de conversa e vendas.</div></div>
      <div class="card"><div class="icon">WA</div><h3>Conexão com WhatsApp</h3><div class="muted">Integração via QR Code/API.</div></div>
      <div class="card"><div class="icon">DB</div><h3>Dashboard completo</h3><div class="muted">Configurações, métricas e monitoramento.</div></div>
      <div class="card"><div class="icon">24</div><h3>Atendimento 24h</h3><div class="muted">Nunca perca um cliente.</div></div>
      <div class="card"><div class="icon">LD</div><h3>Coleta de leads</h3><div class="muted">Capte e exporte contatos.</div></div>
    </div>
  </section>

  <section id="como" class="section reveal">
    <h2>Como funciona</h2>
    <div class="grid-4">
      <div class="card"><strong>Passo 1:</strong> Criar conta</div>
      <div class="card"><strong>Passo 2:</strong> Configurar a IA</div>
      <div class="card"><strong>Passo 3:</strong> Conectar ao WhatsApp</div>
      <div class="card"><strong>Passo 4:</strong> A IA atende automaticamente</div>
    </div>
  </section>

  <section id="planos" class="section reveal">
    <h2>Planos de assinatura</h2>
    <div class="grid-3" id="plans"></div>
  </section>

  <section id="depoimentos" class="section reveal">
    <h2>Depoimentos</h2>
    <div class="grid-3">
      <div class="card"><strong>João Martins – ⭐⭐⭐⭐⭐</strong><div class="muted">Minha IA configurada em menos de 1 dia, atendimento perfeito.</div></div>
      <div class="card"><strong>Carla Ribeiro – ⭐⭐⭐⭐⭐</strong><div class="muted">Fluxos ficaram como eu queria, super profissional.</div></div>
      <div class="card"><strong>Matheus A. – ⭐⭐⭐⭐⭐</strong><div class="muted">Conexão rápida com WhatsApp e métricas claras.</div></div>
      <div class="card"><strong>Bruna Costa – ⭐⭐⭐⭐⭐</strong><div class="muted">Vendas automáticas funcionando 24h.</div></div>
      <div class="card"><strong>Vinícius Torres – ⭐⭐⭐⭐⭐</strong><div class="muted">Melhor custo-benefício, plataforma premium.</div></div>
      <div class="card"><strong>Letícia Moraes – ⭐⭐⭐⭐⭐</strong><div class="muted">Fácil de usar e suporte excelente.</div></div>
    </div>
  </section>

  <section id="conta" class="section reveal">
    <h2>Entrar ou Criar conta</h2>
    <div class="grid-2">
      <div class="card">
        <h3>Criar conta</h3>
        <div style="display:grid; gap:10px">
          <input id="rName" placeholder="Nome" />
          <input id="rEmail" placeholder="Email" />
          <input id="rWhats" placeholder="WhatsApp (com DDD)" />
          <input id="rPass" type="password" placeholder="Senha" />
          <button id="rDo" class="btn btn-primary">Criar</button>
        </div>
      </div>
      <div class="card">
        <h3>Entrar</h3>
        <div style="display:grid; gap:10px">
          <input id="lEmail" placeholder="Email" />
          <input id="lPass" type="password" placeholder="Senha" />
          <button id="lDo" class="btn btn-secondary">Entrar</button>
        </div>
      </div>
    </div>
  </section>

  <section id="user" class="section reveal" style="display:none">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px"><img class="logo" src="logo.png" alt="LUXIAFLOW – IA" style="width:120px" /><h2>Dashboard do Usuário</h2></div>
    <div class="grid-2">
      <div class="card">
        <h3>Status</h3>
        <div class="muted">IA: <span id="uAi"></span> · WhatsApp: <span id="uWa"></span> · Modo humano: <span id="uHo"></span></div>
        <div style="display:flex; gap:10px; margin-top:10px"><button id="uToggleAi" class="btn btn-primary">Ativar/Desativar IA</button><button id="uToggleWa" class="btn btn-secondary">Conectar/Desconectar WhatsApp</button><button id="uHandover" class="btn btn-secondary">Atendimento humano</button><button id="uResume" class="btn btn-secondary">Retomar IA</button><button id="uLogout" class="btn btn-secondary">Sair</button></div>
      </div>
      <div class="card">
        <h3>Métricas</h3>
        <div class="muted">Mensagens: <span id="mMsg">0</span> · Conversas: <span id="mConv">0</span> · Clientes: <span id="mCli">0</span> · Intenções: <span id="mInt">0</span></div>
      </div>
      <div class="card">
        <h3>Editor de respostas automáticas</h3>
        <div style="display:flex; gap:10px"><input id="respIn" placeholder="Nova resposta" /><button id="respAdd" class="btn btn-primary">Adicionar</button></div>
        <ul id="respList" style="margin-top:10px"></ul>
      </div>
      <div class="card">
        <h3>Gatilhos</h3>
        <div style="display:flex; gap:10px"><input id="gatIn" placeholder="Novo gatilho (palavra-chave)" /><button id="gatAdd" class="btn btn-primary">Adicionar</button></div>
        <ul id="gatList" style="margin-top:10px"></ul>
      </div>
      <div class="card">
        <h3>Treinamento</h3>
        <textarea id="trainText" placeholder="Escreva de forma específica como a IA deve responder. Exemplo:\nTOM: profissional, amigável, objetivo\nSAUDAÇÃO: Olá! Sou a IA da LUXIAFLOW. Como posso ajudar?\nENCERRAMENTO: Obrigado pelo contato! Qualquer dúvida, estou à disposição.\nPREÇO: sob orçamento conforme complexidade\nPRAZO: 1 a 3 dias\nPAGAMENTO: PIX e cartão\nHORÁRIO: 08h às 20h\nOFFLINE: Estamos fora do horário. Vou registrar e retornamos.\nCONTATO: WhatsApp 35 9XXXX-XXXX\nFAQ: Entrega? Em até 48h após confirmação\nREGRA: Nunca compartilhe dados sensíveis\nQ: Vocês fazem loja virtual?\nA: Sim, criamos lojas completas com checkout e catálogo."></textarea>
        <div style="margin-top:10px"><button id="trainSave" class="btn btn-secondary">Salvar Treino</button></div>
      </div>
      <div class="card">
        <h3>Fluxos de Atendimento</h3>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap"><input id="flowTrig" placeholder="Gatilho do fluxo" /><input id="flowResp" placeholder="Resposta/ação do fluxo" style="flex:1" /><button id="flowAdd" class="btn btn-secondary">Adicionar fluxo</button></div>
        <ul id="flowList" style="margin-top:8px"></ul>
      </div>
      <div class="card">
        <h3>Testar IA</h3>
        <div id="uChat" style="height:42vh; overflow:auto; display:flex; flex-direction:column; gap:10px; padding:10px; background:#0e1521; border:1px solid rgba(33,200,255,0.18); border-radius:12px"></div>
        <div style="display:flex; gap:10px; margin-top:10px"><input id="uAsk" placeholder="Digite uma pergunta como seu cliente" /><button id="uSend" class="btn btn-primary">Perguntar</button></div>
      </div>
      <div class="card">
        <h3>Integração WhatsApp</h3>
        <div class="muted">1) Gere o QR de vinculação e escaneie com seu celular para conectar.</div>
        <div style="display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; margin-top:8px">
          <img id="qrImg" alt="QR de vinculação" style="width:220px; height:220px; background:#0e1521; border:1px solid rgba(33,200,255,0.25); border-radius:12px; object-fit:contain" />
          <video id="qrVideo" playsinline style="width:240px; max-width:90vw; display:none; background:#0e1521; border:1px solid rgba(33,200,255,0.25); border-radius:12px"></video>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap">
          <button id="genQR" class="btn btn-primary">Gerar QR de Vinculação</button>
          <button id="scanQR" class="btn btn-secondary">Ler QR pela Câmera</button>
          <button id="stopScan" class="btn btn-secondary">Parar Leitura</button>
        </div>
        <div class="muted" style="margin-top:8px">2) Caso seu navegador não tenha leitor de QR, digite o código:</div>
        <div style="display:flex; gap:10px; margin-top:8px"><input id="bindCode" placeholder="Cole o código lido" /><button id="bindDo" class="btn btn-primary">Conectar</button></div>
        <div class="muted" style="margin-top:8px">Após conectar, o status acima muda para “Conectado”.</div>
      </div>
      <div class="card">
        <h3>Tutorial de Configuração</h3>
        <ol style="margin:0; padding-left:20px">
          <li>Escreva o treino com TOM, saudação, regras e FAQ.</li>
          <li>Adicione respostas preferidas e gatilhos.</li>
          <li>Carregue a logo oficial no Admin.</li>
          <li>Gere e escaneie o QR para conectar o WhatsApp.</li>
          <li>Valide e ative a IA.</li>
        </ol>
        <div id="uChecklist" style="margin-top:10px" class="muted"></div>
        <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap"><button id="uValidate" class="btn btn-secondary">Validar Configuração</button><button id="uActivate" class="btn btn-primary">Ativar IA</button></div>
        <div id="uReady" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <section id="admin" class="section reveal" style="display:none">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px"><img class="logo" src="logo.png" alt="LUXIAFLOW – IA" style="width:120px" /><h2>Painel Administrativo</h2></div>
    <div id="adLogin" class="card">
      <div style="display:grid; gap:10px"><input id="adUser" placeholder="Usuário" /><input id="adPass" type="password" placeholder="Senha" /><button id="adDo" class="btn btn-primary">Entrar</button></div>
    </div>
    <div id="adPanel" style="display:none">
      <div class="grid-2">
        <div class="card">
          <h3>Usuários</h3>
          <div class="table-wrap"><table class="table" id="tUsers"><thead><tr><th>Nome</th><th>Email</th><th>IA</th><th>WhatsApp</th><th>Plano</th><th>Ativo</th><th>Ações</th></tr></thead><tbody></tbody></table></div>
        </div>
        <div class="card">
          <h3>Métricas</h3>
          <div class="table-wrap"><table class="table" id="tMetrics"><thead><tr><th>Email</th><th>Mensagens</th><th>Conversas</th><th>Clientes</th><th>Intenções</th></tr></thead><tbody></tbody></table></div>
        </div>
        <div class="card">
          <h3>Planos</h3>
          <div id="adPlans" class="grid-3"></div>
        </div>
        <div class="card">
          <h3>Assinaturas</h3>
          <div style="display:flex; gap:10px"><input id="asEmail" placeholder="Email do usuário" /><select id="asPlan"></select><button id="asSet" class="btn btn-secondary">Definir Plano</button></div>
        </div>
        <div class="card">
          <h3>Marca e Logo</h3>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap"><input id="adLogoUrl" placeholder="URL direto para .png" style="flex:1" /><input id="adLogoFile" type="file" accept="image/*" /><button id="adLogoSave" class="btn btn-primary">Salvar Logo</button></div>
          <div class="muted" style="margin-top:8px">A logo oficial será usada em todas as telas. Recomenda-se usar o URL direto para PNG fornecido.</div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-inner">
      <div class="brand"><img class="logo" src="logo.png" alt="LUXIAFLOW – IA" style="width:120px" /></div>
      <div class="footer-links">
        <a href="#">Termos</a>
        <a href="#">Direitos autorais</a>
        <span class="muted">Feito por Lucas</span>
      </div>
    </div>
  </footer>

  <div id="overlay" class="overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.35); backdrop-filter: blur(2px); opacity:0; pointer-events:none; transition:opacity .3s ease"></div>
  <script>
    const L_USERS='lux_users';
    const L_PLANS='lux_plans';
    const L_SESS='lux_session';
    const L_MET='lux_metrics';
    const L_LOGO_URL='lux_logo_url';
    const DEFAULT_LOGO_URL='https://SEU-LINK-AQUI.com/luxiaflow.png';
    function seed(){ if(!localStorage.getItem(L_PLANS)){ localStorage.setItem(L_PLANS, JSON.stringify([
      {id:'basic', name:'Básico', price:29, features:['Respostas automáticas','Fluxos simples','Conexão WhatsApp']},
      {id:'pro', name:'Profissional', price:59, features:['Treino personalizado','Dashboard avançado','Leads e métricas']},
      {id:'unlimited', name:'Ilimitado', price:99, features:['Tudo do Pro','Fluxos ilimitados','Suporte prioritário']}
    ])); }
    }
    function getUsers(){ try{return JSON.parse(localStorage.getItem(L_USERS)||'[]')}catch{return[]} }
    function setUsers(v){ localStorage.setItem(L_USERS, JSON.stringify(v)) }
    function getPlans(){ try{return JSON.parse(localStorage.getItem(L_PLANS)||'[]')}catch{return[]} }
    function setPlans(v){ localStorage.setItem(L_PLANS, JSON.stringify(v)) }
    function getSession(){ try{return JSON.parse(localStorage.getItem(L_SESS)||'null')}catch{return null} }
    function setSession(v){ localStorage.setItem(L_SESS, JSON.stringify(v)) }
    function getMetrics(){ try{return JSON.parse(localStorage.getItem(L_MET)||'{}')}catch{return{}} }
    function setMetrics(v){ localStorage.setItem(L_MET, JSON.stringify(v)) }
    function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36) }
    const FALLBACK_SVG='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256"><rect width="256" height="256" rx="24" fill="#0b1526"/><circle cx="128" cy="128" r="72" fill="#10233d" stroke="#2dd4ff" stroke-width="6"/><text x="128" y="140" font-size="44" fill="#2dd4ff" text-anchor="middle" font-family="Poppins">LUXIA</text></svg>');
    function currentLogoUrl(){ return localStorage.getItem(L_LOGO_URL) || DEFAULT_LOGO_URL }
    function applyLogo(){ const url=currentLogoUrl(); const imgs=document.querySelectorAll('img.logo'); imgs.forEach(el=>{ el.onerror=()=>{ el.src=FALLBACK_SVG }; el.src=url; }); const fav=document.getElementById('favicon'); if(fav) fav.href=url; }
    async function fileToDataUrl(file){ return new Promise((res,reject)=>{ if(!file){ res(null); return; } const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=reject; r.readAsDataURL(file); }); }
    function register(name,email,whats,pass){ const users=getUsers(); if(users.find(u=>u.email===email)) return {ok:false,msg:'Email já cadastrado'}; const id=uid(); const u={id,name,email,whats,pass,plan:'basic',active:true,ai:{enabled:false,handover:false,responses:[],triggers:[],training:''},whatsapp:{connected:false}}; users.push(u); setUsers(users); setMetrics(Object.assign(getMetrics(),{[id]:{messages:0,conversations:0,clients:0}})); setSession({id,email}); return {ok:true,id} }
    function login(email,pass){ const u=getUsers().find(u=>u.email===email&&u.pass===pass); if(!u) return {ok:false}; setSession({id:u.id,email}); return {ok:true,id:u.id} }
    function logout(){ setSession(null) }
    function me(){ const s=getSession(); if(!s) return null; return getUsers().find(u=>u.id===s.id) }
    function updateUser(user){ const users=getUsers(); const i=users.findIndex(x=>x.id===user.id); if(i>-1){ users[i]=user; setUsers(users); } }
    function incMetric(type){ const s=getSession(); if(!s) return; const met=getMetrics(); const m=met[s.id]||{messages:0,conversations:0,clients:0,intent:0}; if(type==='msg') m.messages++; if(type==='conv') m.conversations++; if(type==='cli') m.clients++; if(type==='intent') m.intent++; met[s.id]=m; setMetrics(met) }
    function renderPlans(){ const el=document.getElementById('plans'); el.innerHTML=''; const ps=getPlans(); for(const p of ps){ const div=document.createElement('div'); div.className='card'; div.innerHTML=`<h3>${p.name}</h3><div class='muted'>R$ ${p.price}/mês</div><ul style='margin-top:8px'>${p.features.map(f=>`<li>${f}</li>`).join('')}</ul><div style='margin-top:10px'><div class='muted'>Para contratar qualquer plano, fale diretamente no WhatsApp: 35 98473-4190.</div><a href='https://wa.me/5535984734190?text=Quero%20assinar%20o%20plano%20${encodeURIComponent(p.name)}%20da%20LUXIAFLOW%20IA' class='btn btn-primary' target='_blank' rel='noopener'>Falar no WhatsApp</a></div>`; el.appendChild(div);} }
    let scanning=false; let stream=null; let detector=null;
    function genBindQR(){ const u=me(); if(!u){ alert('Entre na conta primeiro'); return;} const payload='BIND:'+u.id; const img=document.getElementById('qrImg'); img.src='https://api.qrserver.com/v1/create-qr-code/?size=220x220&data='+encodeURIComponent(payload); }
    async function startScan(){ const video=document.getElementById('qrVideo'); try{
        if(!('BarcodeDetector' in window)){ alert('Leitura de QR não suportada neste navegador. Use o código manual.'); return; }
        detector=new BarcodeDetector({formats:['qr_code']});
        stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        video.style.display='block';
        video.srcObject=stream; await video.play(); scanning=true; scanLoop();
      }catch(err){ alert('Não foi possível abrir a câmera'); }
    }
    async function scanLoop(){ if(!scanning||!detector) return; const video=document.getElementById('qrVideo'); try{ const codes=await detector.detect(video); if(codes&&codes.length){ handleBind(codes[0].rawValue); stopScan(); return; } }catch{} requestAnimationFrame(scanLoop); }
    function stopScan(){ scanning=false; const video=document.getElementById('qrVideo'); video.style.display='none'; try{ if(stream){ stream.getTracks().forEach(t=>t.stop()); } }catch{} stream=null; detector=null; }
    function handleBind(code){ if(!code||!code.startsWith('BIND:')){ alert('Código inválido'); return;} const u=me(); if(!u){ alert('Entre na conta primeiro'); return;} const id=code.slice(5); if(id!==u.id){ alert('Este QR não corresponde à sua conta'); return;} u.whatsapp.connected=true; updateUser(u); showUser(); alert('WhatsApp conectado com sucesso'); }
    seed();
    const revealEls=document.querySelectorAll('.reveal');
    const io=new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('on');io.unobserve(e.target);}})},{threshold:0.25});
    revealEls.forEach(el=>io.observe(el));
    const menuBtn=document.getElementById('menuBtn');
    const nav=document.getElementById('navMain');
    const overlay=document.getElementById('overlay');
    function toggleMenu(){ const open=!nav.classList.contains('open'); nav.classList.toggle('open',open); overlay.style.opacity=open?'1':'0'; overlay.style.pointerEvents=open?'auto':'none'; }
    menuBtn.addEventListener('click',toggleMenu);
    overlay.addEventListener('click',toggleMenu);
    nav.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>{ if(nav.classList.contains('open')) toggleMenu(); }));
    renderPlans();
    applyLogo();
    document.getElementById('genQR').addEventListener('click',genBindQR);
    document.getElementById('scanQR').addEventListener('click',startScan);
    document.getElementById('stopScan').addEventListener('click',stopScan);
    document.getElementById('bindDo').addEventListener('click',()=>{ const code=document.getElementById('bindCode').value.trim(); handleBind(code) });
    function pushChat(text,who){ const box=document.getElementById('uChat'); const d=document.createElement('div'); d.style.borderRadius='12px'; d.style.padding='10px 12px'; d.style.maxWidth='80%'; d.style.background= who==='user' ? '#162235' : '#0f1a2b'; d.style.alignSelf= who==='user' ? 'flex-end' : 'flex-start'; d.textContent=text; box.appendChild(d); box.scrollTop=box.scrollHeight }
    const STOP=['de','da','do','das','dos','e','ou','o','a','os','as','um','uma','uns','umas','para','por','com','sem','no','na','nos','nas','em','ao','à','às','aos','que','como','porque','quando','onde','quanto','qual','quais','sobre'];
    function tokenize(s){ return (s||'').toLowerCase().replace(/[^a-z0-9áéíóúâêîôûãõç ]/g,' ').split(/\s+/).filter(Boolean).filter(w=>!STOP.includes(w)) }
    function rnd(arr){ return arr[Math.floor(Math.random()*arr.length)] }
    function parseTrain(train){ const cfg={}; const lines=(train||'').split(/\n+/).map(s=>s.trim()); cfg.faq=[]; for(const ln of lines){ if(/^tom\s*:/i.test(ln)) cfg.tone=ln.split(':')[1].trim(); else if(/^saudação\s*:/i.test(ln)) cfg.greet=ln.split(':')[1].trim(); else if(/^encerramento\s*:/i.test(ln)) cfg.close=ln.split(':')[1].trim(); else if(/^horário\s*:/i.test(ln)) cfg.hours=ln.split(':')[1].trim(); else if(/^offline\s*:/i.test(ln)) cfg.offline=ln.split(':')[1].trim(); else if(/^regra\s*:/i.test(ln)) { cfg.rules=(cfg.rules||[]); cfg.rules.push(ln.split(':')[1].trim()); } else if(/^q\s*:/i.test(ln)) { cfg.faq.push({q:ln.split(':')[1].trim(),a:''}); } else if(/^a\s*:/i.test(ln)) { const last=cfg.faq[cfg.faq.length-1]; if(last) last.a=ln.split(':')[1].trim(); } } return cfg }
    function parseHours(s){ const m=/([0-2]?\d)h\s*às\s*([0-2]?\d)h/i.exec(s||''); if(!m) return null; return {start:parseInt(m[1],10), end:parseInt(m[2],10)} }
    function aiReply(q,u){ if(u.ai.handover) return null; const t=tokenize(q); const trainRaw=(u.ai.training||''); const train=trainRaw.toLowerCase(); const cfg=parseTrain(trainRaw); const hs=parseHours(cfg.hours); const now=new Date(); const hour=now.getHours(); if(hs && (hour<hs.start || hour>=hs.end) && cfg.offline){ incMetric('intent'); return [cfg.greet,cfg.offline,cfg.close].filter(Boolean).join(' ') } const triggers=(u.ai.triggers||[]).map(x=>x.toLowerCase()); const responses=u.ai.responses||[];
      const intent=(keys)=> keys.some(k=> t.includes(k));
      const kb={
        price: intent(['preço','valor','custa','orçamento']),
        hours: intent(['horário','funciona','atendimento','abre','fecha']),
        delivery: intent(['entrega','prazo','tempo','quando','demora']),
        payment: intent(['pagamento','pix','cartão','pagar']),
        contact: intent(['contato','whatsapp','telefone']),
      };
      const flows=(u.ai.flows||[]);
      for(const f of flows){ if(t.includes((f.t||'').toLowerCase())){ incMetric('intent'); return [cfg.greet,f.r,cfg.close].filter(Boolean).join(' ') } }
      for(const trg of triggers){ if(t.includes(trg)){ incMetric('intent'); const res=rnd([responses[0],'Certo, já envio as informações.','Perfeito, vou cuidar disso agora.'].filter(Boolean)); return [cfg.greet,res,cfg.close].filter(Boolean).join(' ') } }
      if(kb.price){ incMetric('intent'); const fromTrain=(train.match(/preço[:\-]\s*(.*)/)||train.match(/valor[:\-]\s*(.*)/)); const base=rnd(['Os valores variam conforme a necessidade.','Trabalhamos sob demanda, o valor depende do escopo.','O investimento é calculado conforme a complexidade.']); const msg=(fromTrain?(' '+fromTrain[1]):''); return [cfg.greet,base+msg,'Posso estimar agora se preferir.',cfg.close].filter(Boolean).join(' ') }
      if(kb.hours){ incMetric('intent'); const m=(train.match(/horário[:\-]\s*(.*)/)); const base=rnd(['Temos atendimento em janelas estendidas.','Respondemos rápido ao longo do dia.']); const msg=(m?(' Horário: '+m[1]):''); return [cfg.greet,base+msg,cfg.close].filter(Boolean).join(' ') }
      if(kb.delivery){ incMetric('intent'); const m=(train.match(/prazo[:\-]\s*(.*)/)); const base=rnd(['O prazo depende do escopo.','A entrega é ágil e organizada.']); const msg=(m?(' Prazo: '+m[1]):' Em geral, 1–3 dias.'); return [cfg.greet,base+msg,cfg.close].filter(Boolean).join(' ') }
      if(kb.payment){ incMetric('intent'); const m=(train.match(/pagamento[:\-]\s*(.*)/)); const base=rnd(['Podemos confirmar via WhatsApp.','Suportamos PIX e cartão.']); const msg=(m?(' Formas: '+m[1]):''); return [cfg.greet,base+msg,cfg.close].filter(Boolean).join(' ') }
      if(kb.contact){ incMetric('intent'); const m=(train.match(/contato[:\-]\s*(.*)/)); const msg=(m?(' Contato: '+m[1]):'Posso te encaminhar ao WhatsApp agora.'); return [cfg.greet,msg,cfg.close].filter(Boolean).join(' ') }
      let best=null,score=0; for(const qa of (cfg.faq||[])){ const toks=tokenize(qa.q); const s=toks.filter(x=>t.includes(x)).length; if(s>score){ score=s; best=qa } }
      if(best&&best.a){ return [cfg.greet,best.a,cfg.close].filter(Boolean).join(' ') }
      const domainWords=(train.match(/[a-záéíóúâêîôûãõç]{4,}/gi)||[]).slice(0,12).filter((v,i,a)=>a.indexOf(v)===i);
      if(domainWords.length){ const base=rnd(['Somos especialistas em','Trabalhamos intensamente com','Temos domínio em']); return [cfg.greet,base+' '+domainWords.slice(0,4).join(', ')+'. Me diga o que precisa.',cfg.close].filter(Boolean).join(' ') }
      return [cfg.greet,'Posso ajudar com preços, prazos, pagamento e detalhes do seu pedido. Me conte sua necessidade.',cfg.close].filter(Boolean).join(' ')
    }
    document.getElementById('uSend').addEventListener('click',()=>{ const u=me(); if(!u){ alert('Entre na conta primeiro'); return;} const ask=document.getElementById('uAsk').value.trim(); if(!ask) return; pushChat(ask,'user'); const ans=aiReply(ask,u); if(ans===null){ pushChat('Atendimento humano assumiu. A IA está pausada.','bot'); return; } setTimeout(()=>{ pushChat(ans,'bot'); },500) });
    document.getElementById('rDo').addEventListener('click',()=>{ const ok=register(document.getElementById('rName').value,document.getElementById('rEmail').value,document.getElementById('rWhats').value,document.getElementById('rPass').value); if(!ok.ok){ alert(ok.msg||'Erro'); return; } alert('Conta criada'); showUser(); });
    document.getElementById('lDo').addEventListener('click',()=>{ const ok=login(document.getElementById('lEmail').value,document.getElementById('lPass').value); if(!ok.ok){ alert('Credenciais inválidas'); return; } showUser(); });
    function showUser(){ const u=me(); if(!u){ document.getElementById('user').style.display='none'; return; } document.getElementById('user').style.display='block'; document.getElementById('uAi').textContent=u.ai.enabled?'Ativa':'Inativa'; document.getElementById('uWa').textContent=u.whatsapp.connected?'Conectado':'Desconectado'; const ho=document.getElementById('uHo'); if(ho) ho.textContent=u.ai.handover?'Ligado':'Desligado'; const met=getMetrics()[u.id]||{messages:0,conversations:0,clients:0,intent:0}; document.getElementById('mMsg').textContent=met.messages; document.getElementById('mConv').textContent=met.conversations; document.getElementById('mCli').textContent=met.clients; const mi=document.getElementById('mInt'); if(mi) mi.textContent=met.intent||0; const respList=document.getElementById('respList'); respList.innerHTML=''; for(const r of (u.ai.responses||[])){ const li=document.createElement('li'); li.textContent=r; respList.appendChild(li);} const gatList=document.getElementById('gatList'); gatList.innerHTML=''; for(const g of (u.ai.triggers||[])){ const li=document.createElement('li'); li.textContent=g; gatList.appendChild(li);} document.getElementById('trainText').value=u.ai.training||''; }
    document.getElementById('uToggleAi').addEventListener('click',()=>{ const u=me(); if(!u) return; u.ai.enabled=!u.ai.enabled; updateUser(u); showUser() });
    document.getElementById('uToggleWa').addEventListener('click',()=>{ const u=me(); if(!u) return; u.whatsapp.connected=!u.whatsapp.connected; updateUser(u); showUser() });
    document.getElementById('uHandover')?.addEventListener('click',()=>{ const u=me(); if(!u) return; u.ai.handover=true; updateUser(u); showUser(); alert('IA pausada: atendimento humano assumiu.') });
    document.getElementById('uResume')?.addEventListener('click',()=>{ const u=me(); if(!u) return; u.ai.handover=false; updateUser(u); showUser(); alert('IA retomada.') });
    document.getElementById('uLogout').addEventListener('click',()=>{ logout(); alert('Você saiu'); document.getElementById('user').style.display='none' });
    document.getElementById('respAdd').addEventListener('click',()=>{ const u=me(); if(!u) return; const v=document.getElementById('respIn').value.trim(); if(!v) return; u.ai.responses=u.ai.responses||[]; u.ai.responses.push(v); updateUser(u); incMetric('msg'); document.getElementById('respIn').value=''; showUser() });
    document.getElementById('gatAdd').addEventListener('click',()=>{ const u=me(); if(!u) return; const v=document.getElementById('gatIn').value.trim(); if(!v) return; u.ai.triggers=u.ai.triggers||[]; u.ai.triggers.push(v); updateUser(u); incMetric('conv'); document.getElementById('gatIn').value=''; showUser() });
    document.getElementById('trainSave').addEventListener('click',()=>{ const u=me(); if(!u) return; u.ai.training=document.getElementById('trainText').value; updateUser(u); incMetric('cli'); alert('Treino salvo'); showUser() });
    document.getElementById('flowAdd').addEventListener('click',()=>{ const u=me(); if(!u) return; const t=document.getElementById('flowTrig').value.trim(); const r=document.getElementById('flowResp').value.trim(); if(!t||!r){ alert('Preencha gatilho e resposta'); return; } u.ai.flows=u.ai.flows||[]; u.ai.flows.push({t,r}); updateUser(u); document.getElementById('flowTrig').value=''; document.getElementById('flowResp').value=''; renderFlows(); });
    function renderFlows(){ const u=me(); if(!u) return; const list=document.getElementById('flowList'); if(!list) return; list.innerHTML=''; for(const f of (u.ai.flows||[])){ const li=document.createElement('li'); li.textContent=f.t+' → '+f.r; list.appendChild(li); } }
    function checklist(u){ const items=[]; const hasLogo=!!currentLogoUrl(); const hasTrain=(u.ai.training||'').trim().length>=60; const hasResp=(u.ai.responses||[]).length>0; const hasTrig=(u.ai.triggers||[]).length>0; const wa=u.whatsapp.connected; items.push({ok:hasLogo, text:'Logo oficial carregada'}); items.push({ok:hasTrain, text:'Treino preenchido com TOM, saudação, regras e FAQ'}); items.push({ok:hasResp, text:'Pelo menos 1 resposta preferida'}); items.push({ok:hasTrig, text:'Pelo menos 1 gatilho'}); items.push({ok:wa, text:'WhatsApp conectado pelo QR'}); return {items, ready: hasLogo&&hasTrain&&hasResp&&hasTrig&&wa} }
    function renderTutorial(){ const u=me(); if(!u) return; const c=checklist(u); const el=document.getElementById('uChecklist'); const rd=document.getElementById('uReady'); if(el) el.innerHTML=c.items.map(i=>`<div>${i.ok?'✅':'❌'} ${i.text}</div>`).join(''); if(rd) rd.textContent=c.ready?'Tudo pronto para usar.':'Faltam itens na configuração.' }
    document.getElementById('uValidate')?.addEventListener('click',()=>{ renderTutorial() });
    document.getElementById('uActivate')?.addEventListener('click',()=>{ const u=me(); if(!u) return; const c=checklist(u); if(!c.ready){ renderTutorial(); alert('Complete os itens pendentes antes de ativar.'); return; } u.ai.enabled=true; updateUser(u); showUser(); renderTutorial(); alert('IA ativada e pronta para usar.') })
    document.getElementById('adDo').addEventListener('click',()=>{ const u=document.getElementById('adUser').value; const p=document.getElementById('adPass').value; if(u==='Admin'&&p==='Luckas2411'){ document.getElementById('adLogin').style.display='none'; document.getElementById('adPanel').style.display='block'; renderAdmin(); } else { alert('Credenciais inválidas') } });
    document.getElementById('adLogoSave').addEventListener('click',async()=>{ const inUrl=(document.getElementById('adLogoUrl').value||'').trim(); if(inUrl){ if(!/\.png(\?|$)/i.test(inUrl)){ alert('Informe um URL direto para arquivo PNG (.png)'); return; } localStorage.setItem(L_LOGO_URL,inUrl); applyLogo(); alert('Logo atualizada via URL'); return; } const f=document.getElementById('adLogoFile').files[0]; if(!f){ alert('Selecione um arquivo de imagem ou informe o URL .png'); return; } const du=await fileToDataUrl(f); if(!du){ alert('Falha ao ler arquivo'); return; } localStorage.setItem(L_LOGO_URL,du); applyLogo(); alert('Logo atualizada via arquivo'); });
    document.addEventListener('keydown',(e)=>{ if(e.shiftKey&&e.altKey&&e.key.toLowerCase()==='a'){ document.getElementById('adLogin').style.display='block'; window.location.hash='#admin'; } })
    function renderAdmin(){ const users=getUsers(); const plans=getPlans(); const tbody=document.querySelector('#tUsers tbody'); tbody.innerHTML=''; for(const u of users){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${u.name}</td><td>${u.email}</td><td>${u.ai.enabled?'Ativa':'Inativa'}</td><td>${u.whatsapp.connected?'Conectado':'Desconectado'}</td><td>${plans.find(p=>p.id===u.plan)?.name||u.plan}</td><td>${u.active?'Ativo':'Inativo'}</td><td><button data-act='toggle' data-id='${u.id}'>Ativar/Desativar</button></td>`; tbody.appendChild(tr);} tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click',onAdminUserAction)); const met=getMetrics(); const tbodyM=document.querySelector('#tMetrics tbody'); tbodyM.innerHTML=''; for(const u of users){ const m=met[u.id]||{messages:0,conversations:0,clients:0,intent:0}; const tr=document.createElement('tr'); tr.innerHTML=`<td>${u.email}</td><td>${m.messages}</td><td>${m.conversations}</td><td>${m.clients}</td><td>${m.intent||0}</td>`; tbodyM.appendChild(tr);} const adPlans=document.getElementById('adPlans'); adPlans.innerHTML=''; for(const p of plans){ const card=document.createElement('div'); card.className='card'; card.innerHTML=`<h4>${p.name}</h4><div class='muted'>R$ ${p.price}/mês</div><ul style='margin-top:8px'>${p.features.map(f=>`<li>${f}</li>`).join('')}</ul><div style='display:flex; gap:10px; margin-top:8px'><input data-id='${p.id}' class='pPrice' placeholder='Novo preço' /><button data-id='${p.id}' class='pSave btn btn-secondary'>Salvar</button></div>`; adPlans.appendChild(card);} const asPlan=document.getElementById('asPlan'); asPlan.innerHTML=''; for(const p of plans){ const opt=document.createElement('option'); opt.value=p.id; opt.textContent=p.name; asPlan.appendChild(opt); }
    }
    function onAdminUserAction(e){ const id=e.currentTarget.getAttribute('data-id'); const users=getUsers(); const i=users.findIndex(u=>u.id===id); if(i>-1){ users[i].active=!users[i].active; setUsers(users); renderAdmin(); } }
    document.getElementById('asSet').addEventListener('click',()=>{ const email=document.getElementById('asEmail').value; const plan=document.getElementById('asPlan').value; const users=getUsers(); const i=users.findIndex(u=>u.email===email); if(i>-1){ users[i].plan=plan; setUsers(users); alert('Plano atualizado'); renderAdmin(); } else { alert('Usuário não encontrado') } });
    document.addEventListener('click',(e)=>{ if(e.target.classList.contains('pSave')){ const id=e.target.getAttribute('data-id'); const price=parseFloat(e.target.previousElementSibling.value||''); if(isNaN(price)){ alert('Preço inválido'); return; } const plans=getPlans(); const i=plans.findIndex(p=>p.id===id); if(i>-1){ plans[i].price=price; setPlans(plans); alert('Plano salvo'); renderAdmin(); } } });
  </script>
</body>
</html>
